{{ define "main" }}
<section class="project-detail">
    <div class="project-header">
        <div class="project-meta">
            <span>ID: {{ .Params.id }}</span>
            <span>{{ .Params.license }}</span>
            {{ if .Params.link }}
            <span class="github-stars" data-repo="skye-z/{{ .Params.link }}">
                <span class="star-count">...</span> stars
            </span>
            {{ end }}
        </div>
        <h1 class="project-title" style="font-size: 4rem;">{{ .Title }}</h1>
        <div class="project-status">
        {{ if .Params.status }}
            <div class="status-dot"></div> {{ .Params.status }}
        {{ end }}
        </div>
    </div>

    <div class="project-content">
        {{ if .Params.desc_en }}
        <p class="project-desc-en">{{ .Params.desc_en }}</p>
        {{ end }}
        <p class="project-desc-zh serif-accent">{{ .Params.desc_zh }}</p>
    </div>

    <div class="project-actions">
        {{ if .Params.project_url }}
        <a href="{{ .Params.project_url }}" target="_blank" class="project-btn">打开项目</a>
        {{ end }}
        {{ if .Params.link }}
        <a href="https://github.com/skye-z/{{ .Params.link }}" target="_blank" class="project-btn">查看 GitHub</a>
        {{ end }}
        <a href="/" class="project-btn">返回首页</a>
    </div>

    <div class="project-body" id="readme-content">
        {{ if .Params.link }}
        <div class="readme-loading">正在加载 README...</div>
        {{ else }}
        {{ .Content }}
        {{ end }}
    </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

{{ if .Params.link }}
<script>
marked.setOptions({
    gfm: true,
    breaks: true
});

const repo = 'skye-z/{{ .Params.link }}';

fetch('https://api.github.com/repos/' + repo)
    .then(res => res.json())
    .then(data => {
        if (data.stargazers_count !== undefined) {
            document.querySelectorAll('.star-count').forEach(el => {
                el.textContent = data.stargazers_count;
            });
        }
    })
    .catch(() => {});

fetch('https://raw.githubusercontent.com/' + repo + '/main/README.md')
    .then(res => res.text())
    .then(text => {
        const container = document.getElementById('readme-content');
        container.innerHTML = marked.parse(text);
        
        // 修复列表缩进
        container.querySelectorAll('ul, ol').forEach(list => {
            list.style.margin = '0.5rem 0';
            list.style.paddingLeft = '1.5rem';
        });
        container.querySelectorAll('li').forEach(li => {
            li.style.marginBottom = '0.25rem';
            li.style.lineHeight = '1.6';
        });
    })
    .catch(() => {
        document.getElementById('readme-content').innerHTML = 
            '<div class="readme-loading">无法加载 README，请访问 GitHub 查看</div>{{ .Content | safeHTML }}';
    });
</script>

<style>
#readme-content {
    line-height: 1.8;
}
#readme-content h1, #readme-content h2, #readme-content h3 {
    margin: 1.5rem 0 1rem;
    font-family: 'Archivo Black', sans-serif;
    text-transform: uppercase;
}
#readme-content h1 { font-size: 2rem; }
#readme-content h2 { font-size: 1.5rem; }
#readme-content h3 { font-size: 1.25rem; }
#readme-content p {
    margin-bottom: 1rem;
}
#readme-content ul, #readme-content ol {
    margin: 0.5rem 0 !important;
    padding-left: 1.5rem !important;
}
#readme-content li {
    margin-bottom: 0.25rem !important;
    line-height: 1.6 !important;
    list-style-type: inherit !important;
}
#readme-content li ul, #readme-content li ol {
    margin: 0.25rem 0 !important;
}
#readme-content li p {
    margin: 0 !important;
}
#readme-content blockquote {
    margin: 1rem 0;
    padding: 0.5rem 1rem;
    border-left: 4px solid var(--ink);
    background: rgba(10, 10, 10, 0.05);
}
#readme-content blockquote p {
    margin-bottom: 0;
}
#readme-content pre {
    background: rgba(10, 10, 10, 0.1);
    padding: 1rem;
    margin: 1rem 0;
    border: 1px solid var(--ink);
    white-space: pre-wrap;
    word-wrap: break-word;
    max-width: 100%;
}
#readme-content code {
    font-family: 'Space Mono', monospace;
    font-size: 0.9rem;
}
#readme-content p code {
    background: rgba(10, 10, 10, 0.1);
    padding: 0.2rem 0.4rem;
}
#readme-content a {
    color: var(--ink);
    text-decoration: underline;
}
#readme-content img {
    max-width: 100%;
    height: auto;
    margin: 1rem 0;
}
#readme-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
}
#readme-content th, #readme-content td {
    border: 1px solid var(--ink);
    padding: 0.5rem;
    text-align: left;
}
#readme-content th {
    background: rgba(10, 10, 10, 0.1);
}
#readme-content hr {
    border: none;
    border-top: 1px solid var(--ink);
    margin: 2rem 0;
}
#readme-content .task-list-item {
    list-style: none !important;
    margin-left: 0 !important;
    padding-left: 1.5rem !important;
}
#readme-content .task-list-item input[type="checkbox"] {
    margin-right: 0.5rem !important;
}
#readme-content .task-list-item > ul, 
#readme-content .task-list-item > ol {
    padding-left: 1.5rem !important;
}
#readme-content .task-list-item li {
    list-style: inherit !important;
}
</style>
{{ end }}
{{ end }}
